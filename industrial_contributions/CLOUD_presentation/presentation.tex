\documentclass[9pt, aspectratio=169]{beamer}
% \documentclass[10pt]{beamer}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usetheme{Frankfurt}

\usepackage[backend=biber, style=authoryear]{biblatex}
\addbibresource{local_references.bib}

%\usepackage{lmodern}
\usepackage{amsfonts,amssymb,amsmath}
\usepackage[english]{babel}
\usetheme{Frankfurt}

\usepackage{csquotes}
\usepackage{setspace}

\usepackage{colortbl}
\usepackage{tabularx}
\renewcommand\tabularxcolumn[1]{m{#1}}

% --- Tickz
\usepackage{physics}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{mathdots}
\usepackage{yhmath}
\usepackage{cancel}
\usepackage{color}
\usepackage{siunitx}
\usepackage{array}
\usepackage{multirow}
\usepackage{amssymb}
\usepackage{gensymb}
\usepackage{tabularx}
\usepackage{extarrows}
\usepackage{booktabs}
\usetikzlibrary{fadings}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes}

% ---------

\usepackage{booktabs}
\usepackage{setspace}
\usepackage{amssymb}
\usepackage{adjustbox}
\usepackage{pifont}
\usepackage[inkscapeformat=png]{svg}
\usepackage{graphicx}
\usepackage{times}
\setbeamertemplate{caption}[numbered]
% % \setbeamertemplate{bibliography item}{[\theenumiv]}

\setbeamerfont{bibliography item}{size=\tiny}
\setbeamerfont{bibliography entry author}{size=\tiny}
\setbeamerfont{bibliography entry title}{size=\tiny}
\setbeamerfont{bibliography entry location}{size=\tiny}
\setbeamerfont{bibliography entry note}{size=\tiny}

\setbeamerfont{frametitle}{size=\large}

\usepackage{caption}
\usepackage{float}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{animate}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
 
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}
 
\lstset{style=mystyle}

\usepackage{ragged2e}
\setbeamercolor{section in foot}{fg=white,bg=darkorange}
\setbeamercolor{subsection in foot}{fg=white,bg=darkorange}
\setbeamercolor{frametitle}{fg=white, bg=darkorange}
\setbeamercolor{title}{fg=white, bg=darkorange}
\setbeamercolor{frame}{bg=darkorange}
\setbeamercolor{block title}{bg=darkorange,fg=white}

\setbeamercolor{item}{fg=darkorange}

% \definecolor{darkorange}{rgb}{0.81, 0.52, 0.05}
\definecolor{darkorange}{rgb}{1,0.5,0}
\definecolor{darkorange2}{rgb}{1, 0.64, 0.2}
\definecolor{honeydew}{rgb}{1, 0.85, 0.45}


\newenvironment{variableblock}[3]{%
  \setbeamercolor{block body}{#2}
  \setbeamercolor{block title}{#3}
  \begin{block}{#1}}{\end{block}}

\newenvironment{prosblock}[1]{%
  % \setbeamercolor{block body}{bg=blue,fg=white}
  \setbeamercolor{block title}{bg=blue,fg=white}
  \begin{block}{#1}}{\end{block}}

\newenvironment{consblock}[1]{%
  % \setbeamercolor{block body}{bg=red,fg=white}
  \setbeamercolor{block title}{bg=red,fg=white}
  \begin{block}{#1}}{\end{block}}

\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%

\renewcommand{\arraystretch}{1.5}

% Please add the following required packages to your document preamble:
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{colortbl}
% Beamer presentation requires \usepackage{colortbl} instead of \usepackage[table,xcdraw]{xcolor}

\usepackage{tabularray}\UseTblrLibrary{varwidth}
\usepackage{xcolor}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
% \usepackage{cite}
\usepackage{amsmath}
\newcommand{\probP}{\text{I\kern-0.15em P}}
\usepackage{etoolbox}
\patchcmd{\thebibliography}{\section*{\refname}}{}{}{}

\setlength\tabcolsep{0.5pt}

\renewcommand{\arraystretch}{0.9}
\setlength{\tabcolsep}{2pt}

\usepackage{pgffor}

\setbeamerfont{bibliography item}{size=\tiny}
\setbeamerfont{bibliography entry author}{size=\tiny}
\setbeamerfont{bibliography entry title}{size=\tiny}
\setbeamerfont{bibliography entry location}{size=\tiny}
\setbeamerfont{bibliography entry note}{size=\tiny}

\setbeamerfont{bibliography entry author}{shape=\upshape,series=\mdseries,size=\footnotesize}
\setbeamerfont{bibliography entry title}{shape=\slshape,series=\mdseries,size=\footnotesize}
\setbeamerfont{bibliography entry journal}{shape=\upshape,series=\mdseries,size=\footnotesize}
\setbeamerfont{bibliography entry note}{shape=\upshape,series=\mdseries,size=\footnotesize}

\renewcommand*{\bibfont}{\scriptsize}

\newenvironment<>{varblock}[2][.9\textwidth]{%
  \setlength{\textwidth}{#1}
  \begin{actionenv}#3%
    \def\insertblocktitle{#2}%
    \par%
    \usebeamertemplate{block begin}}
  {\par%
    \usebeamertemplate{block end}%
  \end{actionenv}}

% \setbeamertemplate{footline}[frame number]

\setbeamertemplate{footline}{
  \leavevmode%
  \hfill
  \usebeamercolor[fg]{page number in head/foot}%
  \scriptsize%
  \ifnum\value{framenumber}>16%
    Appendix \number\numexpr\value{framenumber}-13\relax/32%
  \else%
    \ifnum\value{framenumber}>13%
      %
    \else
      \number\numexpr\value{framenumber}\relax/13%
    \fi

  \fi%
  \hspace{1em}
}

\begin{document}

\input{cover}

% \begin{frame}{Content}
%   \tableofcontents
% \end{frame}

\addtocounter{framenumber}{-1}

\section{Introduction}

\begin{frame}{Context and Problem}
  \begin{columns}
    \column{0.4\textwidth}
    \begin{itemize}
      \item Kubernetes clusters often fail under dynamic conditions (e.g., DDoS, bottlenecks).
      \item Traditional HPA is reactive and struggles with complex failure contexts.
      \item RL-based autoscalers optimize single metrics (e.g., latency), ignoring failure diversity.
      \item \textbf{Need}: A resilient autoscaling system addressing \textit{multiple failure types} collaboratively.
    \end{itemize}

    \column{0.7\textwidth}
    \includegraphics[width=\linewidth]{figures/scenario_introduction.pdf}
  \end{columns}
\end{frame}

\begin{frame}{Related Works}
  \begin{columns}
    \column{0.5\textwidth}
    \begin{itemize}
      \item \textbf{Gym-HPA}~\parencite{gymhpa2022}, \textbf{QoS-RL}~\parencite{QoSRL}: learning-based, but limited to simulated settings and single-goal.
      \item \textbf{AWARE}~\parencite{aware2023}: partial adversarial support, no multi-agent reasoning.
    \end{itemize}

    \column{0.5\textwidth}
    \begin{itemize}
      \item \textbf{RLad-core}~\parencite{Rossi2019}: adaptive mono-agent scaling, lacks explainability.
      \item \textbf{AHPA}~\parencite{Zhou2024}, \textbf{KOSMOS}~\parencite{KOSMOS}, \textbf{COPA}~\parencite{COPA}: hybrid approaches, rule-based or reactive, non-learning.
    \end{itemize}

  \end{columns}

  \vspace{0.5cm}

  \begin{center}

    \centering
    \vfill
    \footnotesize
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{lccccccc}
      \hline
      \textbf{Criterion}   & \textbf{Gym-HPA} & \textbf{AWARE} & \textbf{RLad} & \textbf{QoS-RL} & \textbf{AHPA} & \textbf{KOSMOS} & \textbf{COPA} \\
      \hline
      Adversarial Handling & \xmark           & $\sim$         & \xmark        & \xmark          & \xmark        & \xmark          & $\sim$        \\
      Multi-Goal Support   & \xmark           & \cmark         & $\sim$        & \cmark          & \xmark        & \cmark          & \xmark        \\
      Learning-Based       & \cmark           & \cmark         & \cmark        & \cmark          & \xmark        & \xmark          & \xmark        \\
      MAS Support          & \xmark           & \xmark         & \xmark        & \xmark          & \xmark        & \xmark          & \xmark        \\
      Real Env. Ready      & \xmark           & \cmark         & \cmark        & \cmark          & \cmark        & \cmark          & \cmark        \\
      Explainable          & \xmark           & \xmark         & \xmark        & \xmark          & \xmark        & \xmark          & \xmark        \\
      Adaptation Capacity  & \cmark           & $\sim$         & $\sim$        & $\sim$          & \cmark        & \cmark          & $\sim$        \\
      \hline
    \end{tabular}
  \end{center}

  \vspace{0.5cm}

  $\rightarrow$ \textbf{Most systems lack}: MAS coordination, explainability, and resilience to adversarial conditions.

\end{frame}

\begin{frame}{Our Proposition: KARMA Framework}
  \begin{columns}
    \column{0.3\textwidth}
    \begin{itemize}
      \item We introduce \textbf{KARMA}: a 4-phase framework for resilient autoscaling.
      \item Decomposes autoscaling into specialized agent roles and missions.
      \item Uses \textbf{Multi-Agent Reinforcement Learning} (MARL) guided by organizational constraints.
      \item Operates in a closed-loop with the real Kubernetes cluster.
    \end{itemize}

    \column{0.75\textwidth}
    \centering
    \input{figures/karma_architecture/karma_architecture.tex}
  \end{columns}
\end{frame}

\section{The KARMA framework}

\begin{frame}{Phase 1: Modeling (Digital Twin)}
  \begin{columns}
    \column{0.4\textwidth}
    \begin{itemize}
      \item Collected traces from real cluster \(\Rightarrow\) state-action transitions.
      \item Modeled as a \textbf{zero-sum Stochastic Game} with attacker and defenders.
      \item Uses an MLP to approximate unknown transitions: \( \hat{T}(s, a) \approx s' \).
      \item Enables near-realistic training without impacting production.
    \end{itemize}

    \column{0.7\textwidth}
    \centering
    \includegraphics[trim=0cm 3.3cm 0cm 3.5cm, clip, width=\linewidth]{figures/k8s_cluster_graph.pdf}
  \end{columns}
\end{frame}

\begin{frame}{Phase 2: Training (Constrained/Guided MARL)}
  \begin{columns}
    \column{0.55\textwidth}
    \begin{itemize}
      \item Agents are trained using Multi-Agent PPO (MAPPO).
      \item Roles constrain actions via \textbf{Role Action Guides (RAG)}.
      \item Missions guide learning via \textbf{Goal Reward Guides (GRG)}.
      \item Constraints can be hard (enforced) or soft (shaping rewards).
      \item Ensures specialization and coordination across agents.
      \item Based on the \textbf{MOISE+MARL}~\parencite{soule2024moise_marl}~\footnote{\tiny J. Soule, J.-P. Jamont, M. Occello, L.-M. Traonouez, and P. ThÃ©ron. An organizationally-oriented approach to enhancing explainability and control in multi-agent reinforcement learning. Proc. of the 24th Int. Conf. on Autonomous Agents and Multiagent Systems (AAMAS), 2025.}.
    \end{itemize}

    \hspace{-1cm}

    \column{0.55\textwidth}
    \includegraphics[width=\linewidth]{figures/mm_simple_representation.png}
  \end{columns}
\end{frame}

\begin{frame}{Phase 3: Analyzing Agent Behaviors}
  \begin{columns}
    \column{0.55\textwidth}
    \begin{itemize}
      \item Analyze trained policies to interpret \textbf{implicit roles and missions}.
      \item Clustering of trajectories:
            \begin{itemize}
              \item Action sequences $\Rightarrow$ roles
              \item State visitation patterns $\Rightarrow$ goals
            \end{itemize}
      \item Inspired by the \textbf{TEMM} method from \textbf{MOISE+MARL}.
      \item Improves explainability and supports system design refinement.
      \item Enables better understanding of coordination and interactions.
    \end{itemize}

    \column{0.4\textwidth}
    \centering
    \input{figures/abstract_obs_processed_viz.tex}

    \vspace{0.5cm}

    \input{figures/abstract_full_processed_viz.tex}

  \end{columns}
\end{frame}

\begin{frame}{Phase 4: Transfer to Real Cluster}
  \begin{columns}
    \column{0.35\textwidth}
    \begin{itemize}
      \item Deploy trained agents to control the real Kubernetes cluster.
      \item Agents interact via the Kubernetes API to scale pods.
      \item A fallback mechanism ensures safety in production.
      \item Digital twin remains updated in parallel with real-time data.
      \item Supports iterative retraining and adaptation.
    \end{itemize}

    \column{0.75\textwidth}
    \centering
    \input{figures/karma_architecture/karma_architecture.tex}
  \end{columns}
\end{frame}

\section{Experiments and discussion}

\begin{frame}{Experimental Setup}
  \begin{columns}
    \column{0.4\textwidth}
    \begin{itemize}
      \item Simulated Kubernetes cluster with 4 microservices in cascade.
      \item Services connected as a directed chain: A $\rightarrow$ B $\rightarrow$ C $\rightarrow$ D.
      \item Injected dynamic failures:
            \begin{itemize}
              \item DDoS attacks on random services
              \item Resource bottlenecks (CPU/memory)
              \item Crashes and restarts
            \end{itemize}
      \item Agents act on replicas of each pod type to adapt flow.
      \item Training and evaluation performed on a high-performance GPU cluster.
    \end{itemize}

    \column{0.7\textwidth}
    \centering
    \includegraphics[trim=0cm 3.3cm 0cm 3.5cm, clip, width=\linewidth]{figures/k8s_cluster_graph.pdf}

  \end{columns}
\end{frame}

\begin{frame}{Comparative Evaluation (1/2)}
  \begin{columns}
    \column{0.4\textwidth}
    \begin{itemize}
      \item We compare KARMA against:
            \begin{itemize}
              \item AWARE (baseline MARL)
              \item Gym-HPA (standard RL autoscaler)
              \item Rlad-core (mono-agent approach)
            \end{itemize}
      \item Metrics evaluated:
            \begin{itemize}
              \item Success rate (QoS satisfaction)
              \item Average latency
              \item Pending request queue length
            \end{itemize}
      \item KARMA achieves higher resilience and efficiency across all metrics.
    \end{itemize}

    \column{0.6\textwidth}

    \begin{table}[h!]
      \centering
      \caption{\small Comparative results on operational resilience and adversarial recovery.}
      \label{tab:combined_evaluation}
      \small
      \renewcommand{\arraystretch}{1.5}
      \setlength{\tabcolsep}{6pt}
      \begin{tabular}{>{\raggedright\arraybackslash}m{1.0cm}
        >{\centering\arraybackslash}m{1.0cm}
        >{\centering\arraybackslash}m{1.1cm}
        >{\centering\arraybackslash}m{1.1cm}
        >{\centering\arraybackslash}m{1.0cm}
        >{\centering\arraybackslash}m{1.0cm}}
        \hline
        \textbf{Baseline} & \textbf{Succ.} & \textbf{Latency} & \textbf{Pending} & \textbf{Recov.} & \textbf{Avail.} \\
                          & \textbf{(\%)}  & \textbf{(\%)}    & \textbf{(\%)}    & \textbf{(s)}    & \textbf{(\%)}   \\
        \hline
        KHPA              & 64.8           & 58.1             & 20.7             & 80.7            & 65.6            \\
        Gym-HPA           & 73.1           & 65.7             & 20.8             & 66.2            & 72.6            \\
        Rlad-core         & 77.4           & 70.1             & 15.9             & 37.4            & 78.3            \\
        AWARE             & 80.6           & 73.8             & 13.3             & 49.5            & 83.6            \\
        \textbf{KARMA}    & \textbf{90.9}  & \textbf{85.7}    & \textbf{5.9}     & \textbf{33.0}   & \textbf{90.7}   \\
        \hline
      \end{tabular}
    \end{table}


  \end{columns}
\end{frame}

\begin{frame}{Comparative Evaluation (2/2)}
  \begin{columns}

    \column{0.4\textwidth}
    \begin{itemize}
      \item Learning curves show:
            \begin{itemize}
              \item Faster convergence for KARMA
              \item More stable reward evolution over time
              \item Less variance across seeds
            \end{itemize}
      \item Role constraints reduce the policy search space.
      \item Multi-agent structure encourages coordinated exploration.
      \item KARMA generalizes better under diverse failure conditions.
    \end{itemize}

    \column{0.65\textwidth}
    \includegraphics[width=0.95\linewidth]{figures/learning_curves.pdf}

  \end{columns}
\end{frame}

\begin{frame}{Explainability \& Organizational Fit}
  \begin{columns}
    \column{0.5\textwidth}
    \begin{itemize}
      \item Post-hoc analysis of agent behaviors:
            \begin{itemize}
              \item Role identification via trajectory clustering
              \item Mission recognition via observation patterns
            \end{itemize}
      \item Computation of \textbf{Organizational Fit} metrics:
            \begin{itemize}
              \item Structural Fit (alignment to roles)
              \item Functional Fit (goal achievement patterns)
            \end{itemize}
      \item Helps validate whether emergent behavior matches organizational design.
    \end{itemize}

    \column{0.5\textwidth}

    \includegraphics[width=0.95\linewidth]{figures/role_hierarchical_clustering.pdf}

    \

    \includegraphics[width=0.95\linewidth]{figures/roles_graph.pdf}

  \end{columns}
\end{frame}

\begin{frame}{Ablation Studies}
  \begin{columns}
    \column{0.4\textwidth}
    \begin{itemize}
      \item We conducted ablations to assess component impact:
            \begin{itemize}
              \item \textbf{No digital twin}: -11\% performance
              \item \textbf{Mono-agent}: degraded coordination, higher latency
              \item \textbf{No organizational constraints}: higher variance, slower convergence
            \end{itemize}
      \item Each component (Twin, MARL, MOISE+) contributes significantly.
      \item The full KARMA stack yields best trade-off: performance + explainability + robustness.
    \end{itemize}

    \column{0.6\textwidth}
    \centering
    \begin{table}[h!]
      \centering
      \caption{\scriptsize Ablation study: impact of organizational structure and multi-agent design.}
      \label{tab:ablation_study}
      \scriptsize
      \renewcommand{\arraystretch}{1.5}
      \setlength{\tabcolsep}{6pt}
      \begin{tabular}{>{\raggedright\arraybackslash}m{1.5cm}
        >{\centering\arraybackslash}m{0.8cm}
        >{\centering\arraybackslash}m{0.7cm}
        >{\centering\arraybackslash}m{0.7cm}
        >{\centering\arraybackslash}m{0.7cm}
        >{\centering\arraybackslash}m{0.7cm}}
        \hline
        \textbf{Configuration}                   & \textbf{Succ. (\%)} & \textbf{Latency (\%)} & \textbf{Pending (\%)} & \textbf{Recov. (s)} & \textbf{Avail. (\%)} \\
        \hline
        Single-Agent \textit{w/o} Org. Spec.     & 72.6                & 65.4                  & 17.0                  & 60.3                & 72.4                 \\
        Single-Agent \textit{w/} Hard Org. Spec. & 80.8                & 72.5                  & 15.4                  & 48.5                & 77.5                 \\
        Multi-Agent \textit{w/o} Org. Spec.      & 87.7                & 81.5                  & 9.3                   & 43.5                & 82.0                 \\
        Multi-Agent \textit{w/} Soft Org. Spec.  & 82.0                & 74.7                  & 15.0                  & 38.8                & 86.0                 \\
        \textbf{KARMA (Multi-Agent + Hard)}      & \textbf{90.9}       & \textbf{85.7}         & \textbf{5.9}          & \textbf{33.0}       & \textbf{90.7}        \\
        \hline
      \end{tabular}
    \end{table}


  \end{columns}
\end{frame}

\section{Conclusion}

\begin{frame}{Conclusion \& Perspectives}
  \begin{itemize}
    \item \textbf{KARMA} framework addresses 6 key gaps in resilient autoscaling:
          \begin{itemize}
            \item Online MAS design
            \item Failure-aware training
            \item Organizational constraints
            \item Explainability of agents
            \item Safe deployment
            \item Continuous adaptation
          \end{itemize}
    \item Combines Digital Twin + Guided MARL + Org. Fit Analysis.
    \item \textbf{Perspectives}:
          \begin{itemize}
            \item Real multi-node Kubernetes cluster
            \item Extend to more service types (e.g. streaming)
            \item Use LLMs to document behaviors or missions
          \end{itemize}
  \end{itemize}

\end{frame}


\appendix
%\setbeamertemplate{headline}{}
\setbeamertemplate{mini frames}{}

\input{sections/thanks}

\section*{\phantom{References}}
\begin{frame}[allowframebreaks]{References}{}
  \printbibliography
\end{frame}

\newcounter{mainframenumber}
\setcounter{mainframenumber}{\value{framenumber}}

% % \input{sections/annexes}


\end{document}
